@model AgroManagement.Models.ViewModels.DashboardVM
@{
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<style>
    /* ✅ Simple hover effect */
    .stat-card {
        border: 0;
        border-radius: 14px;
        box-shadow: 0 10px 18px rgba(0,0,0,0.08);
        transition: transform .18s ease, box-shadow .18s ease;
        background: #ffffff;
    }

        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 16px 28px rgba(0,0,0,0.12);
            background-color: palegreen;
        }

    /* ✅ small green accent */
    .stat-label {
        color: rgba(15,23,42,0.65);
        font-weight: 600;
        margin-bottom: 6px;
    }

    .stat-number {
        font-size: 34px;
        font-weight: 900;
        color: #166534; /* greenish */
        line-height: 1.1;
    }
</style>

<div class="container mt-4">
    <h2 class="mb-4">Admin Dashboard</h2>

    <!-- Cards -->
    <div class="row g-3 mb-4">
        <div class="col-md-4">
            <div class="card stat-card p-3 text-center">
                <div class="stat-label">Total Employees</div>
                <div class="stat-number count-up" data-target="@Model.TotalEmployees">0</div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card stat-card p-3 text-center">
                <div class="stat-label">Total Animals</div>
                <div class="stat-number count-up" data-target="@Model.TotalAnimals">0</div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card stat-card p-3 text-center">
                <div class="stat-label">Total Users</div>
                <div class="stat-number count-up" data-target="@Model.TotalUsers">0</div>
            </div>
        </div>

        <div class="col-md-6">
            <div class="card stat-card p-3 text-center">
                <div class="stat-label">Tasks Assigned (Overall)</div>
                <div class="stat-number count-up" data-target="@Model.TotalTasksAssigned">0</div>
            </div>
        </div>

        <div class="col-md-6">
            <div class="card stat-card p-3 text-center">
                <div class="stat-label">Tasks Remaining (Unassigned)</div>
                <div class="stat-number count-up" data-target="@Model.TasksRemaining">0</div>
            </div>
        </div>
    </div>

    <!-- Charts -->
    <div class="row g-4">
        <div class="col-md-7">
            <div class="card  p-3">
                <h5 class="mb-3">Tasks Assigned Per Employee</h5>
                <canvas id="barChart" height="180"></canvas>
            </div>
        </div>

        <div class="col-md-5">
            <div class="card  p-3">
                <h5 class="mb-3">Assigned vs Unassigned Tasks</h5>
                <canvas id="pieChart" height="180"></canvas>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
        // ✅ Simple count-up animation
        function animateCount(el, target, durationMs = 900) {
            const startTime = performance.now();

            function step(now) {
                const progress = Math.min((now - startTime) / durationMs, 1);
                const value = Math.floor(target * progress);
                el.textContent = value.toLocaleString();
                if (progress < 1) requestAnimationFrame(step);
            }

            requestAnimationFrame(step);
        }

        document.querySelectorAll('.count-up').forEach(el => {
            const target = parseInt(el.getAttribute('data-target') || "0", 10);
            animateCount(el, target, 900);
        });

        // BAR CHART
        const barCtx = document.getElementById('barChart').getContext('2d');
        new Chart(barCtx, {
            type: 'bar',
            data: {
                labels: @Html.Raw(System.Text.Json.JsonSerializer.Serialize(Model.EmployeeNames)),
                datasets: [{
                    label: 'Tasks',
                    data: @Html.Raw(System.Text.Json.JsonSerializer.Serialize(Model.TasksPerEmployee)),
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                scales: { y: { beginAtZero: true } }
            }
        });

        // PIE CHART
        const pieCtx = document.getElementById('pieChart').getContext('2d');
        new Chart(pieCtx, {
            type: 'pie',
            data: {
                labels: ['Assigned', 'Unassigned'],
                datasets: [{
                    data: [@Model.TotalTasksAssigned, @Model.TotalTasksUnassigned]
                }]
            },
            options: { responsive: true }
        });
    </script>
}
